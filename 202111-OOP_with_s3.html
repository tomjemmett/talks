<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Object Orientated Programming with S3</title>
    <meta charset="utf-8" />
    <meta name="author" content="[Tom Jemmett][tj_email] | Senior Healthcare Analyst" />
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <link href="libs/animate.css-xaringan-3.7.2/animate.fade.css" rel="stylesheet" />
    <link href="libs/panelset-0.2.6/panelset.css" rel="stylesheet" />
    <script src="libs/panelset-0.2.6/panelset.js"></script>
    <script src="libs/js-cookie-3.0.0/js.cookie.js"></script>
    <script src="libs/peerjs-1.3.1/peerjs.min.js"></script>
    <script src="libs/tiny.toast-1.0.0/toast.min.js"></script>
    <link href="libs/xaringanExtra-broadcast-0.2.6/broadcast.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-broadcast-0.2.6/broadcast.js"></script>
    <link rel="stylesheet" href="css/nhsr.css" type="text/css" />
    <link rel="stylesheet" href="css/nhsr-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">







```r
getOption("icon.path")
```

```
## [1] "~/icons"
```

```r
dir.exists(getOption("icon.path"))
```

```
## [1] TRUE
```

```r
dir(getOption("icon.path"))
```

```
## [1] "de.svg"      "em.svg"      "fontawesome" "gh.svg"      "li.svg"     
## [6] "tw.svg"
```

---

class: title-slide, left, bottom

# Object Orientated Programming with S3
----
## **NHS-R Conference 2021**
### **[Tom Jemmett][tj_email]** | Senior Healthcare Analyst
### 8&lt;sup&gt;th&lt;/sup&gt; November 2021

---

# About The Strategy Unit / Me

.pull-left[
***"Leading research, analysis and change from within the NHS"***

**The Strategy Unit** is a specialist **NHS** team, based in [**Midlands and Lancashire CSU**][mlcsu]. We focus on the
application of high-quality, multi-disciplinary analytical work.

Our team comes from diverse backgrounds. Our academic qualifications include maths, economics, history, natural
sciences, medicine, sociology, business and management, psychology and political science. Our career and personal
histories are just as varied.

Our staff are **NHS** employees, animated by **NHS** values. **The Strategy Unit** covers all its costs through project
funding. But this is driven by need, not what we can sell. Any surplus is recycled for public benefit.

[][su_web] | [][su_email] | [][su_twitter] | [][su_github] |
[][su_linkedin]
]

.pull-right[
**Tom Jemmett**

*Senior Healthcare Analyst*

[thomas.jemmett@nhs.net][tj_email]

- 10+ years experience within the NHS as a data analyst
- BSc Computer Science and Pure Mathematics ([Open University][open_uni])
- [MBCS][bcs]/[AMIMA][ima]
- Active member of NHS-R community
- Senior Fellow of NHS-R academy
- [AphA][apha] member, West Midlands branch champion

[][tj_email] | [][tj_twitter] | [][tj_github] | [][tj_linkedin]
]

---
class: middle, center

# What is Object Orientated Programming?

Let's have a look at a specific example, the `summary()` function.

---

# The `summary()` function

.panelset[

.panel[.panel-name[numeric vector]

```r
my_numbers &lt;- rnorm(20)
summary(my_numbers)
```

```
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
## -1.8735 -1.3339 -0.5388 -0.2282  0.6961  2.8868
```
]

.panel[.panel-name[character vector]

```r
my_text &lt;- c("Hello", "World")
summary(my_text)
```

```
##    Length     Class      Mode 
##         2 character character
```

]

.panel[.panel-name[data.frame]
.scroll-panel[

```r
summary(penguins)
```

```
##       species          island    bill_length_mm  bill_depth_mm  
##  Adelie   :152   Biscoe   :168   Min.   :32.10   Min.   :13.10  
##  Chinstrap: 68   Dream    :124   1st Qu.:39.23   1st Qu.:15.60  
##  Gentoo   :124   Torgersen: 52   Median :44.45   Median :17.30  
##                                  Mean   :43.92   Mean   :17.15  
##                                  3rd Qu.:48.50   3rd Qu.:18.70  
##                                  Max.   :59.60   Max.   :21.50  
##                                  NA's   :2       NA's   :2      
##  flipper_length_mm  body_mass_g       sex           year     
##  Min.   :172.0     Min.   :2700   female:165   Min.   :2007  
##  1st Qu.:190.0     1st Qu.:3550   male  :168   1st Qu.:2007  
##  Median :197.0     Median :4050   NA's  : 11   Median :2008  
##  Mean   :200.9     Mean   :4202                Mean   :2008  
##  3rd Qu.:213.0     3rd Qu.:4750                3rd Qu.:2009  
##  Max.   :231.0     Max.   :6300                Max.   :2009  
##  NA's   :2         NA's   :2
```
]
]

.panel[.panel-name[linear model]
.scroll-panel[


```r
model &lt;- lm(data = drop_na(penguins), body_mass_g ~ flipper_length_mm)
summary(model)
```

```
## 
## Call:
## lm(formula = body_mass_g ~ flipper_length_mm, data = drop_na(penguins))
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1057.33  -259.79   -12.24   242.97  1293.89 
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)       -5872.09     310.29  -18.93   &lt;2e-16 ***
## flipper_length_mm    50.15       1.54   32.56   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 393.3 on 331 degrees of freedom
## Multiple R-squared:  0.7621,	Adjusted R-squared:  0.7614 
## F-statistic:  1060 on 1 and 331 DF,  p-value: &lt; 2.2e-16
```
]
]
]

---
class: middle, center

# How does `summary()` know how to do different things for different types of data?

---

# A big long list of if's and else's?

``` r
summary &lt;- function(object, ...) {
  if (is.numeric(object)) {
    summary.numeric(object, ...)
  } else if (is.character(object)) {
    summary.character(object, ...)
  } else if (is.data.frame(object)) {
    summary.data.frame(object)
  } else if (is.linear_model(object)) {
    summary.lm(object)
  } else {
    ...
  }
}
```


---
class: middle, center

![this is fine meme](img/this-is-fine.jpg)

---

# Is the previous code maintainable?

- `summary()` would need to have an `if` statement for every single different type of data that comes with base R

--

- and every single different type of data that other users have created

--

- and every single different type of data that may be created before the next R release

---
class: middle, center

![gif of a cat looking confused saying wait, what?](img/wait-what.gif)

---

# So how does summary work?


```r
get("summary")
```

```
## function (object, ...) 
## UseMethod("summary")
## &lt;bytecode: 0x564eb29a53b8&gt;
## &lt;environment: namespace:base&gt;
```

--

``` r
?UseMethod
```

&gt; R possesses a simple generic function mechanism which can be used for an object-oriented style of programming. Method
&gt; dispatch takes place based on the class(es) of the first argument to the generic function or of the object supplied as
&gt; an argument to UseMethod or NextMethod.

---

# What is a "class"? (in s3)

.panelset[
.panel[.panel-name[numeric vector]

```r
class(my_numbers)
```

```
## [1] "numeric"
```
]

.panel[.panel-name[character vector]

```r
class(my_text)
```

```
## [1] "character"
```
]

.panel[.panel-name[data.frame]

```r
class(penguins)
```

```
## [1] "tbl_df"     "tbl"        "data.frame"
```

]
.panel[.panel-name[linear model]

```r
class(model)
```

```
## [1] "lm"
```
]
]

Every value (or, "object") has one or more classes.

A function like `summary()` is called a generic function which will take an object, look at the objects class(es), and
then look to find a function that matches the first class, e.g. `summary.lm()`.

If it doesn't find a function for the first class, it will move onto the second class.

If it doesn't manage to find a function at all it will try `summary.default()`.

---

# What other generic functions are there?

.pull-left[
The big ones that you will no doubt be using day after day are:

- `c()`
- `plot()`
- `print()` (called any time you type a variable into the console in R&lt;sup&gt;1&lt;/sup&gt;)
- `ggplot()`
- most of the `{dplyr}` verbs (e.g. `mutate()`, `select()`, `filter()`)

.footnote[
[1] (sort of)
]
]

.pull-right[

It's also possible to create new generic functions. First, create the "generic" function:

``` r
my_generic &lt;- function(x, ...)
  UseMethod("my_generic")
```

Then, create implementations of this generic for the different types of data you want to support.

``` r
my_generic.data.frame &lt;- function(x, ...)
  do_stuff()
my_generic.lm &lt;- function(x, ...)
  do_other_stuff()
```

]

---

# Can you create your own class of data?

Yes! And it's super easy!

.panelset[
.panel[.panel-name[using a list]

```r
my_data &lt;- structure(
  list(
    name = "Tom", works_for = "The Strategy Unit", favourite_food = "üçï"
  ),
  class = "about_me"
)

print.about_me &lt;- function(x, ...) {
  cat("My name is ", x$name, ", and I work for ", x$works_for, ". ",
      "My favourite food is ", x$favourite_food, "\n", sep = "")
}

print(my_data)
```

```
## My name is Tom, and I work for The Strategy Unit. My favourite food is üçï
```
]

.panel[.panel-name[using a dataframe]
.scroll-panel[

```r
my_penguins &lt;- penguins # this is a tibble, which are a superset of data.frame
# prepend our class to the existing classes
class(my_penguins) &lt;- c("my_penguins", class(my_penguins))

print.my_penguins &lt;- function(x, ...) {
  cat("Penguins are awesome! üêß\n")
  NextMethod() # now call the normal tibble print method
}

print(my_penguins)
```

```
## Penguins are awesome! üêß
## # A tibble: 344 √ó 8
##    species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
##    &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
##  1 Adelie  Torgersen           39.1          18.7               181        3750
##  2 Adelie  Torgersen           39.5          17.4               186        3800
##  3 Adelie  Torgersen           40.3          18                 195        3250
##  4 Adelie  Torgersen           NA            NA                  NA          NA
##  5 Adelie  Torgersen           36.7          19.3               193        3450
##  6 Adelie  Torgersen           39.3          20.6               190        3650
##  7 Adelie  Torgersen           38.9          17.8               181        3625
##  8 Adelie  Torgersen           39.2          19.6               195        4675
##  9 Adelie  Torgersen           34.1          18.1               193        3475
## 10 Adelie  Torgersen           42            20.2               190        4250
## # ‚Ä¶ with 334 more rows, and 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;
```
]
]
]

---

# In Summary:

- s3 is a way to make generic code that works with different types of data, but will produce different results
- s3 works by having a "generic" function which will "dispatch" to the right function based on the "class" of the data
- you can inspect the class of an object using `class(my_obj)`, or set it using `class(my_obj) &lt;- "class"`
- you can create new generic methods by creating a function that uses `UseMethod()`
- you can create implementations of a generic by creating a function named `[generic].[class]()`

---

# What next:

- Go read the OOP chapters in [Advanced-R][advr-oop]
- There are other types of OOP in R
  - s3
  - s4
  - RC/R6
  - ggproto
- I would advice learning s3 and R6 (R6 is far more similar to OOP found in other languages like C++, Java, C#, Python)
- ggproto is only useful if you want to create your own ggplot extensions/work on ggplot

- learn another programming language! See how OOP is different elsewhere! üôÇ

---
class: middle, center

# Thanks! Enjoy the rest of the conference!
## join the [NHS-R slack][nhsr-slack]

Extra special thanks to Silvia Canel√≥n ([@spcanelon](https://twitter.com/spcanelon)) for building the `{xaringan}` theme
for the [`{NHSRtheme}`][nhsrtheme] package.

&lt;!-- urls etc. --&gt;
[tj_email]: mailto:thomas.jemmett@nhs.net
[tj_twitter]: https://twitter.com/tomjemmett
[tj_github]: https://github.com/tomjemmett
[tj_linkedin]: https://www.linkedin.com/in/tom-jemmett-3872a8159/

[su_web]: https://strategyunitwm.nhs.uk/
[su_email]: mailto:strategy.unit@nhs.net
[su_twitter]: https://twitter.com/strategy_unit
[su_github]: https://github.com/The-Strategy-Unit/
[su_linkedin]: https://www.linkedin.com/company/the-strategy-unit/

[mlcsu]: https://www.midlandsandlancashirecsu.nhs.uk/

[open_uni]: https://www.open.ac.uk/
[bcs]: https://www.bcs.org/
[ima]: https://ima.org.uk/
[apha]: https://www.aphanalysts.org/

[advr-oop]: https://adv-r.hadley.nz/oo.html
[nhsr-slack]: https://join.slack.com/t/nhsrcommunity/shared_invite/zt-arabo68y-_Uv5uU2dmtfe8mk5ing9Fg

[nhsrtheme]: https://github.com/nhs-r-community/NHSRtheme
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "googlecode",
"highlightLines": true,
"highlightLanguage": "r",
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>
<!--Hat-tip: https://www.garrickadenbuie.com/blog/xaringan-tip-logo-all-slides/-->
<style>
.logo {
  background-image: url(img/logo-blue.png);
  background-size: contain;
  background-repeat: no-repeat;
  position: absolute;
  top: 1em;
  right: 1em;
  width: 110px;
  height: 128px;
  z-index: 0;
}
</style>

<script>
document
  .querySelectorAll(
    '.remark-slide-content' +
    ':not(.title-slide)' +
    // add additional classes to exclude here, e.g.
    ':not(.inverse)' +
    ':not(.hide-logo)'
  )
  .forEach(el => {
    el.innerHTML += '<div class="logo"></div>';
  });
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
